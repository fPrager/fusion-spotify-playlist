// Copyright 2018-2022 the Deno authors. All rights reserved. MIT license.
// Copyright Joyent and Node contributors. All rights reserved. MIT license.
import { resolve, toFileUrl } from "../path/mod.ts";
import { notImplemented } from "./_utils.ts";
import { EventEmitter, once } from "./events.ts";
let environmentData = new Map();
let threads = 0;
const kHandle = Symbol("kHandle");
const PRIVATE_WORKER_THREAD_NAME = "$DENO_STD_NODE_WORKER_THREAD";
class _Worker extends EventEmitter {
    threadId;
    resourceLimits = {
        maxYoungGenerationSizeMb: -1,
        maxOldGenerationSizeMb: -1,
        codeRangeSizeMb: -1,
        stackSizeMb: 4
    };
    [kHandle];
    postMessage;
    constructor(specifier, options){
        super();
        if (options?.eval === true) {
            specifier = `data:text/javascript,${specifier}`;
        } else if (typeof specifier === "string") {
            specifier = toFileUrl(resolve(specifier));
        }
        const handle = this[kHandle] = new Worker(specifier, {
            name: PRIVATE_WORKER_THREAD_NAME,
            type: "module"
        });
        handle.addEventListener("error", (event)=>this.emit("error", event.error || event.message));
        handle.addEventListener("messageerror", (event)=>this.emit("messageerror", event.data));
        handle.addEventListener("message", (event)=>this.emit("message", event.data));
        handle.postMessage({
            environmentData,
            threadId: this.threadId = ++threads,
            workerData: options?.workerData
        }, options?.transferList || []);
        this.postMessage = handle.postMessage.bind(handle);
        this.emit("online");
    }
    terminate() {
        this[kHandle].terminate();
        this.emit("exit", 0);
    }
    getHeapSnapshot = ()=>notImplemented("Worker.prototype.getHeapSnapshot");
    // fake performance
    performance = globalThis.performance;
}
export const isMainThread = // deno-lint-ignore no-explicit-any
globalThis.name !== PRIVATE_WORKER_THREAD_NAME;
// fake resourceLimits
export const resourceLimits = isMainThread ? {} : {
    maxYoungGenerationSizeMb: 48,
    maxOldGenerationSizeMb: 2048,
    codeRangeSizeMb: 0,
    stackSizeMb: 4
};
let threadId = 0;
let workerData = null;
// deno-lint-ignore no-explicit-any
let parentPort = null;
if (!isMainThread) {
    // deno-lint-ignore no-explicit-any
    delete globalThis.name;
    // deno-lint-ignore no-explicit-any
    const listeners = new WeakMap();
    parentPort = self;
    parentPort.off = parentPort.removeListener = function(name, listener) {
        this.removeEventListener(name, listeners.get(listener));
        listeners.delete(listener);
        return this;
    };
    parentPort.on = parentPort.addListener = function(name, listener) {
        // deno-lint-ignore no-explicit-any
        const _listener = (ev)=>listener(ev.data);
        listeners.set(listener, _listener);
        this.addEventListener(name, _listener);
        return this;
    };
    parentPort.once = function(name, listener) {
        // deno-lint-ignore no-explicit-any
        const _listener = (ev)=>listener(ev.data);
        listeners.set(listener, _listener);
        this.addEventListener(name, _listener);
        return this;
    };
    // mocks
    parentPort.setMaxListeners = ()=>{};
    parentPort.getMaxListeners = ()=>Infinity;
    parentPort.eventNames = ()=>[
            ""
        ];
    parentPort.listenerCount = ()=>0;
    parentPort.emit = ()=>notImplemented("parentPort.emit");
    parentPort.removeAllListeners = ()=>notImplemented("parentPort.removeAllListeners");
    // Receive startup message
    [{ threadId , workerData , environmentData  }] = await once(parentPort, "message");
    // alias
    parentPort.addEventListener("offline", ()=>{
        parentPort.emit("close");
    });
}
export function getEnvironmentData(key) {
    return environmentData.get(key);
}
export function setEnvironmentData(key, value) {
    if (value === undefined) {
        environmentData.delete(key);
    } else {
        environmentData.set(key, value);
    }
}
// deno-lint-ignore no-explicit-any
const _MessagePort = globalThis.MessagePort;
const _MessageChannel = // deno-lint-ignore no-explicit-any
globalThis.MessageChannel;
export const BroadcastChannel = globalThis.BroadcastChannel;
export const SHARE_ENV = Symbol.for("nodejs.worker_threads.SHARE_ENV");
export function markAsUntransferable() {
    notImplemented("markAsUntransferable");
}
export function moveMessagePortToContext() {
    notImplemented("moveMessagePortToContext");
}
export function receiveMessageOnPort() {
    notImplemented("receiveMessageOnPort");
}
export { _MessageChannel as MessageChannel, _MessagePort as MessagePort, _Worker as Worker, parentPort, threadId, workerData };
export default {
    markAsUntransferable,
    moveMessagePortToContext,
    receiveMessageOnPort,
    MessagePort: _MessagePort,
    MessageChannel: _MessageChannel,
    BroadcastChannel,
    Worker: _Worker,
    getEnvironmentData,
    setEnvironmentData,
    SHARE_ENV,
    threadId,
    workerData,
    resourceLimits,
    parentPort,
    isMainThread
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3N0ZEAwLjE2Ny4wL25vZGUvd29ya2VyX3RocmVhZHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTgtMjAyMiB0aGUgRGVubyBhdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBNSVQgbGljZW5zZS5cbi8vIENvcHlyaWdodCBKb3llbnQgYW5kIE5vZGUgY29udHJpYnV0b3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBNSVQgbGljZW5zZS5cblxuaW1wb3J0IHsgcmVzb2x2ZSwgdG9GaWxlVXJsIH0gZnJvbSBcIi4uL3BhdGgvbW9kLnRzXCI7XG5pbXBvcnQgeyBub3RJbXBsZW1lbnRlZCB9IGZyb20gXCIuL191dGlscy50c1wiO1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyLCBvbmNlIH0gZnJvbSBcIi4vZXZlbnRzLnRzXCI7XG5cbmxldCBlbnZpcm9ubWVudERhdGEgPSBuZXcgTWFwKCk7XG5sZXQgdGhyZWFkcyA9IDA7XG5cbmV4cG9ydCBpbnRlcmZhY2UgV29ya2VyT3B0aW9ucyB7XG4gIC8vIG9ubHkgZm9yIHR5cGluZ3NcbiAgYXJndj86IHVua25vd25bXTtcbiAgZW52PzogUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gIGV4ZWNBcmd2Pzogc3RyaW5nW107XG4gIHN0ZGluPzogYm9vbGVhbjtcbiAgc3Rkb3V0PzogYm9vbGVhbjtcbiAgc3RkZXJyPzogYm9vbGVhbjtcbiAgdHJhY2tVbm1hbmFnZWRGZHM/OiBib29sZWFuO1xuICByZXNvdXJjZUxpbWl0cz86IHtcbiAgICBtYXhZb3VuZ0dlbmVyYXRpb25TaXplTWI/OiBudW1iZXI7XG4gICAgbWF4T2xkR2VuZXJhdGlvblNpemVNYj86IG51bWJlcjtcbiAgICBjb2RlUmFuZ2VTaXplTWI/OiBudW1iZXI7XG4gICAgc3RhY2tTaXplTWI/OiBudW1iZXI7XG4gIH07XG5cbiAgZXZhbD86IGJvb2xlYW47XG4gIHRyYW5zZmVyTGlzdD86IFRyYW5zZmVyYWJsZVtdO1xuICB3b3JrZXJEYXRhPzogdW5rbm93bjtcbn1cblxuY29uc3Qga0hhbmRsZSA9IFN5bWJvbChcImtIYW5kbGVcIik7XG5jb25zdCBQUklWQVRFX1dPUktFUl9USFJFQURfTkFNRSA9IFwiJERFTk9fU1REX05PREVfV09SS0VSX1RIUkVBRFwiO1xuY2xhc3MgX1dvcmtlciBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gIHJlYWRvbmx5IHRocmVhZElkOiBudW1iZXI7XG4gIHJlYWRvbmx5IHJlc291cmNlTGltaXRzOiBSZXF1aXJlZDxcbiAgICBOb25OdWxsYWJsZTxXb3JrZXJPcHRpb25zW1wicmVzb3VyY2VMaW1pdHNcIl0+XG4gID4gPSB7XG4gICAgbWF4WW91bmdHZW5lcmF0aW9uU2l6ZU1iOiAtMSxcbiAgICBtYXhPbGRHZW5lcmF0aW9uU2l6ZU1iOiAtMSxcbiAgICBjb2RlUmFuZ2VTaXplTWI6IC0xLFxuICAgIHN0YWNrU2l6ZU1iOiA0LFxuICB9O1xuICBwcml2YXRlIHJlYWRvbmx5IFtrSGFuZGxlXTogV29ya2VyO1xuXG4gIHBvc3RNZXNzYWdlOiBXb3JrZXJbXCJwb3N0TWVzc2FnZVwiXTtcblxuICBjb25zdHJ1Y3RvcihzcGVjaWZpZXI6IFVSTCB8IHN0cmluZywgb3B0aW9ucz86IFdvcmtlck9wdGlvbnMpIHtcbiAgICBzdXBlcigpO1xuICAgIGlmIChvcHRpb25zPy5ldmFsID09PSB0cnVlKSB7XG4gICAgICBzcGVjaWZpZXIgPSBgZGF0YTp0ZXh0L2phdmFzY3JpcHQsJHtzcGVjaWZpZXJ9YDtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBzcGVjaWZpZXIgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHNwZWNpZmllciA9IHRvRmlsZVVybChyZXNvbHZlKHNwZWNpZmllcikpO1xuICAgIH1cbiAgICBjb25zdCBoYW5kbGUgPSB0aGlzW2tIYW5kbGVdID0gbmV3IFdvcmtlcihcbiAgICAgIHNwZWNpZmllcixcbiAgICAgIHtcbiAgICAgICAgbmFtZTogUFJJVkFURV9XT1JLRVJfVEhSRUFEX05BTUUsXG4gICAgICAgIHR5cGU6IFwibW9kdWxlXCIsXG4gICAgICB9IGFzIGdsb2JhbFRoaXMuV29ya2VyT3B0aW9ucywgLy8gYnlwYXNzIHVuc3RhYmxlIHR5cGUgZXJyb3JcbiAgICApO1xuICAgIGhhbmRsZS5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgXCJlcnJvclwiLFxuICAgICAgKGV2ZW50KSA9PiB0aGlzLmVtaXQoXCJlcnJvclwiLCBldmVudC5lcnJvciB8fCBldmVudC5tZXNzYWdlKSxcbiAgICApO1xuICAgIGhhbmRsZS5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgXCJtZXNzYWdlZXJyb3JcIixcbiAgICAgIChldmVudCkgPT4gdGhpcy5lbWl0KFwibWVzc2FnZWVycm9yXCIsIGV2ZW50LmRhdGEpLFxuICAgICk7XG4gICAgaGFuZGxlLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICBcIm1lc3NhZ2VcIixcbiAgICAgIChldmVudCkgPT4gdGhpcy5lbWl0KFwibWVzc2FnZVwiLCBldmVudC5kYXRhKSxcbiAgICApO1xuICAgIGhhbmRsZS5wb3N0TWVzc2FnZSh7XG4gICAgICBlbnZpcm9ubWVudERhdGEsXG4gICAgICB0aHJlYWRJZDogKHRoaXMudGhyZWFkSWQgPSArK3RocmVhZHMpLFxuICAgICAgd29ya2VyRGF0YTogb3B0aW9ucz8ud29ya2VyRGF0YSxcbiAgICB9LCBvcHRpb25zPy50cmFuc2Zlckxpc3QgfHwgW10pO1xuICAgIHRoaXMucG9zdE1lc3NhZ2UgPSBoYW5kbGUucG9zdE1lc3NhZ2UuYmluZChoYW5kbGUpO1xuICAgIHRoaXMuZW1pdChcIm9ubGluZVwiKTtcbiAgfVxuXG4gIHRlcm1pbmF0ZSgpIHtcbiAgICB0aGlzW2tIYW5kbGVdLnRlcm1pbmF0ZSgpO1xuICAgIHRoaXMuZW1pdChcImV4aXRcIiwgMCk7XG4gIH1cblxuICByZWFkb25seSBnZXRIZWFwU25hcHNob3QgPSAoKSA9PlxuICAgIG5vdEltcGxlbWVudGVkKFwiV29ya2VyLnByb3RvdHlwZS5nZXRIZWFwU25hcHNob3RcIik7XG4gIC8vIGZha2UgcGVyZm9ybWFuY2VcbiAgcmVhZG9ubHkgcGVyZm9ybWFuY2UgPSBnbG9iYWxUaGlzLnBlcmZvcm1hbmNlO1xufVxuXG5leHBvcnQgY29uc3QgaXNNYWluVGhyZWFkID1cbiAgLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbiAgKGdsb2JhbFRoaXMgYXMgYW55KS5uYW1lICE9PSBQUklWQVRFX1dPUktFUl9USFJFQURfTkFNRTtcblxuLy8gZmFrZSByZXNvdXJjZUxpbWl0c1xuZXhwb3J0IGNvbnN0IHJlc291cmNlTGltaXRzID0gaXNNYWluVGhyZWFkID8ge30gOiB7XG4gIG1heFlvdW5nR2VuZXJhdGlvblNpemVNYjogNDgsXG4gIG1heE9sZEdlbmVyYXRpb25TaXplTWI6IDIwNDgsXG4gIGNvZGVSYW5nZVNpemVNYjogMCxcbiAgc3RhY2tTaXplTWI6IDQsXG59O1xuXG5sZXQgdGhyZWFkSWQgPSAwO1xubGV0IHdvcmtlckRhdGE6IHVua25vd24gPSBudWxsO1xuXG4vLyBMaWtlIGh0dHBzOi8vZ2l0aHViLmNvbS9ub2RlanMvbm9kZS9ibG9iLzQ4NjU1ZTE3ZTFkODRiYTUwMjFkN2E5NGI0Yjg4ODIzZjdjOWM2Y2YvbGliL2ludGVybmFsL2V2ZW50X3RhcmdldC5qcyNMNjExXG5pbnRlcmZhY2UgTm9kZUV2ZW50VGFyZ2V0IGV4dGVuZHNcbiAgUGljazxcbiAgICBFdmVudEVtaXR0ZXIsXG4gICAgXCJldmVudE5hbWVzXCIgfCBcImxpc3RlbmVyQ291bnRcIiB8IFwiZW1pdFwiIHwgXCJyZW1vdmVBbGxMaXN0ZW5lcnNcIlxuICA+IHtcbiAgc2V0TWF4TGlzdGVuZXJzKG46IG51bWJlcik6IHZvaWQ7XG4gIGdldE1heExpc3RlbmVycygpOiBudW1iZXI7XG4gIC8vIGRlbm8tbGludC1pZ25vcmUgbm8tZXhwbGljaXQtYW55XG4gIG9mZihldmVudE5hbWU6IHN0cmluZywgbGlzdGVuZXI6ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCk6IE5vZGVFdmVudFRhcmdldDtcbiAgLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbiAgb24oZXZlbnROYW1lOiBzdHJpbmcsIGxpc3RlbmVyOiAoLi4uYXJnczogYW55W10pID0+IHZvaWQpOiBOb2RlRXZlbnRUYXJnZXQ7XG4gIC8vIGRlbm8tbGludC1pZ25vcmUgbm8tZXhwbGljaXQtYW55XG4gIG9uY2UoZXZlbnROYW1lOiBzdHJpbmcsIGxpc3RlbmVyOiAoLi4uYXJnczogYW55W10pID0+IHZvaWQpOiBOb2RlRXZlbnRUYXJnZXQ7XG4gIGFkZExpc3RlbmVyOiBOb2RlRXZlbnRUYXJnZXRbXCJvblwiXTtcbiAgcmVtb3ZlTGlzdGVuZXI6IE5vZGVFdmVudFRhcmdldFtcIm9mZlwiXTtcbn1cblxudHlwZSBQYXJlbnRQb3J0ID0gdHlwZW9mIHNlbGYgJiBOb2RlRXZlbnRUYXJnZXQ7XG5cbi8vIGRlbm8tbGludC1pZ25vcmUgbm8tZXhwbGljaXQtYW55XG5sZXQgcGFyZW50UG9ydDogUGFyZW50UG9ydCA9IG51bGwgYXMgYW55O1xuXG5pZiAoIWlzTWFpblRocmVhZCkge1xuICAvLyBkZW5vLWxpbnQtaWdub3JlIG5vLWV4cGxpY2l0LWFueVxuICBkZWxldGUgKGdsb2JhbFRoaXMgYXMgYW55KS5uYW1lO1xuICAvLyBkZW5vLWxpbnQtaWdub3JlIG5vLWV4cGxpY2l0LWFueVxuICBjb25zdCBsaXN0ZW5lcnMgPSBuZXcgV2Vha01hcDwoLi4uYXJnczogYW55W10pID0+IHZvaWQsIChldjogYW55KSA9PiBhbnk+KCk7XG5cbiAgcGFyZW50UG9ydCA9IHNlbGYgYXMgUGFyZW50UG9ydDtcbiAgcGFyZW50UG9ydC5vZmYgPSBwYXJlbnRQb3J0LnJlbW92ZUxpc3RlbmVyID0gZnVuY3Rpb24gKFxuICAgIHRoaXM6IFBhcmVudFBvcnQsXG4gICAgbmFtZSxcbiAgICBsaXN0ZW5lcixcbiAgKSB7XG4gICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKG5hbWUsIGxpc3RlbmVycy5nZXQobGlzdGVuZXIpISk7XG4gICAgbGlzdGVuZXJzLmRlbGV0ZShsaXN0ZW5lcik7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG4gIHBhcmVudFBvcnQub24gPSBwYXJlbnRQb3J0LmFkZExpc3RlbmVyID0gZnVuY3Rpb24gKFxuICAgIHRoaXM6IFBhcmVudFBvcnQsXG4gICAgbmFtZSxcbiAgICBsaXN0ZW5lcixcbiAgKSB7XG4gICAgLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbiAgICBjb25zdCBfbGlzdGVuZXIgPSAoZXY6IGFueSkgPT4gbGlzdGVuZXIoZXYuZGF0YSk7XG4gICAgbGlzdGVuZXJzLnNldChsaXN0ZW5lciwgX2xpc3RlbmVyKTtcbiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIobmFtZSwgX2xpc3RlbmVyKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcbiAgcGFyZW50UG9ydC5vbmNlID0gZnVuY3Rpb24gKHRoaXM6IFBhcmVudFBvcnQsIG5hbWUsIGxpc3RlbmVyKSB7XG4gICAgLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbiAgICBjb25zdCBfbGlzdGVuZXIgPSAoZXY6IGFueSkgPT4gbGlzdGVuZXIoZXYuZGF0YSk7XG4gICAgbGlzdGVuZXJzLnNldChsaXN0ZW5lciwgX2xpc3RlbmVyKTtcbiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIobmFtZSwgX2xpc3RlbmVyKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICAvLyBtb2Nrc1xuICBwYXJlbnRQb3J0LnNldE1heExpc3RlbmVycyA9ICgpID0+IHt9O1xuICBwYXJlbnRQb3J0LmdldE1heExpc3RlbmVycyA9ICgpID0+IEluZmluaXR5O1xuICBwYXJlbnRQb3J0LmV2ZW50TmFtZXMgPSAoKSA9PiBbXCJcIl07XG4gIHBhcmVudFBvcnQubGlzdGVuZXJDb3VudCA9ICgpID0+IDA7XG5cbiAgcGFyZW50UG9ydC5lbWl0ID0gKCkgPT4gbm90SW1wbGVtZW50ZWQoXCJwYXJlbnRQb3J0LmVtaXRcIik7XG4gIHBhcmVudFBvcnQucmVtb3ZlQWxsTGlzdGVuZXJzID0gKCkgPT5cbiAgICBub3RJbXBsZW1lbnRlZChcInBhcmVudFBvcnQucmVtb3ZlQWxsTGlzdGVuZXJzXCIpO1xuXG4gIC8vIFJlY2VpdmUgc3RhcnR1cCBtZXNzYWdlXG4gIFt7IHRocmVhZElkLCB3b3JrZXJEYXRhLCBlbnZpcm9ubWVudERhdGEgfV0gPSBhd2FpdCBvbmNlKFxuICAgIHBhcmVudFBvcnQsXG4gICAgXCJtZXNzYWdlXCIsXG4gICk7XG5cbiAgLy8gYWxpYXNcbiAgcGFyZW50UG9ydC5hZGRFdmVudExpc3RlbmVyKFwib2ZmbGluZVwiLCAoKSA9PiB7XG4gICAgcGFyZW50UG9ydC5lbWl0KFwiY2xvc2VcIik7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RW52aXJvbm1lbnREYXRhKGtleTogdW5rbm93bikge1xuICByZXR1cm4gZW52aXJvbm1lbnREYXRhLmdldChrZXkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0RW52aXJvbm1lbnREYXRhKGtleTogdW5rbm93biwgdmFsdWU/OiB1bmtub3duKSB7XG4gIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgZW52aXJvbm1lbnREYXRhLmRlbGV0ZShrZXkpO1xuICB9IGVsc2Uge1xuICAgIGVudmlyb25tZW50RGF0YS5zZXQoa2V5LCB2YWx1ZSk7XG4gIH1cbn1cblxuLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbmNvbnN0IF9NZXNzYWdlUG9ydDogdHlwZW9mIE1lc3NhZ2VQb3J0ID0gKGdsb2JhbFRoaXMgYXMgYW55KS5NZXNzYWdlUG9ydDtcbmNvbnN0IF9NZXNzYWdlQ2hhbm5lbDogdHlwZW9mIE1lc3NhZ2VDaGFubmVsID1cbiAgLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbiAgKGdsb2JhbFRoaXMgYXMgYW55KS5NZXNzYWdlQ2hhbm5lbDtcbmV4cG9ydCBjb25zdCBCcm9hZGNhc3RDaGFubmVsID0gZ2xvYmFsVGhpcy5Ccm9hZGNhc3RDaGFubmVsO1xuZXhwb3J0IGNvbnN0IFNIQVJFX0VOViA9IFN5bWJvbC5mb3IoXCJub2RlanMud29ya2VyX3RocmVhZHMuU0hBUkVfRU5WXCIpO1xuZXhwb3J0IGZ1bmN0aW9uIG1hcmtBc1VudHJhbnNmZXJhYmxlKCkge1xuICBub3RJbXBsZW1lbnRlZChcIm1hcmtBc1VudHJhbnNmZXJhYmxlXCIpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIG1vdmVNZXNzYWdlUG9ydFRvQ29udGV4dCgpIHtcbiAgbm90SW1wbGVtZW50ZWQoXCJtb3ZlTWVzc2FnZVBvcnRUb0NvbnRleHRcIik7XG59XG5leHBvcnQgZnVuY3Rpb24gcmVjZWl2ZU1lc3NhZ2VPblBvcnQoKSB7XG4gIG5vdEltcGxlbWVudGVkKFwicmVjZWl2ZU1lc3NhZ2VPblBvcnRcIik7XG59XG5leHBvcnQge1xuICBfTWVzc2FnZUNoYW5uZWwgYXMgTWVzc2FnZUNoYW5uZWwsXG4gIF9NZXNzYWdlUG9ydCBhcyBNZXNzYWdlUG9ydCxcbiAgX1dvcmtlciBhcyBXb3JrZXIsXG4gIHBhcmVudFBvcnQsXG4gIHRocmVhZElkLFxuICB3b3JrZXJEYXRhLFxufTtcblxuZXhwb3J0IGRlZmF1bHQge1xuICBtYXJrQXNVbnRyYW5zZmVyYWJsZSxcbiAgbW92ZU1lc3NhZ2VQb3J0VG9Db250ZXh0LFxuICByZWNlaXZlTWVzc2FnZU9uUG9ydCxcbiAgTWVzc2FnZVBvcnQ6IF9NZXNzYWdlUG9ydCxcbiAgTWVzc2FnZUNoYW5uZWw6IF9NZXNzYWdlQ2hhbm5lbCxcbiAgQnJvYWRjYXN0Q2hhbm5lbCxcbiAgV29ya2VyOiBfV29ya2VyLFxuICBnZXRFbnZpcm9ubWVudERhdGEsXG4gIHNldEVudmlyb25tZW50RGF0YSxcbiAgU0hBUkVfRU5WLFxuICB0aHJlYWRJZCxcbiAgd29ya2VyRGF0YSxcbiAgcmVzb3VyY2VMaW1pdHMsXG4gIHBhcmVudFBvcnQsXG4gIGlzTWFpblRo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