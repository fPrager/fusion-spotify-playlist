// Copyright 2018-2022 the Deno authors. All rights reserved. MIT license.
import { denoErrorToNodeError } from "../internal/errors.ts";
import { promisify } from "../internal/util.mjs";
export function convertFileInfoToStats(origin) {
    return {
        dev: origin.dev,
        ino: origin.ino,
        mode: origin.mode,
        nlink: origin.nlink,
        uid: origin.uid,
        gid: origin.gid,
        rdev: origin.rdev,
        size: origin.size,
        blksize: origin.blksize,
        blocks: origin.blocks,
        mtime: origin.mtime,
        atime: origin.atime,
        birthtime: origin.birthtime,
        mtimeMs: origin.mtime?.getTime() || null,
        atimeMs: origin.atime?.getTime() || null,
        birthtimeMs: origin.birthtime?.getTime() || null,
        isFile: ()=>origin.isFile,
        isDirectory: ()=>origin.isDirectory,
        isSymbolicLink: ()=>origin.isSymlink,
        // not sure about those
        isBlockDevice: ()=>false,
        isFIFO: ()=>false,
        isCharacterDevice: ()=>false,
        isSocket: ()=>false,
        ctime: origin.mtime,
        ctimeMs: origin.mtime?.getTime() || null
    };
}
function toBigInt(number) {
    if (number === null || number === undefined) return null;
    return BigInt(number);
}
export function convertFileInfoToBigIntStats(origin) {
    return {
        dev: toBigInt(origin.dev),
        ino: toBigInt(origin.ino),
        mode: toBigInt(origin.mode),
        nlink: toBigInt(origin.nlink),
        uid: toBigInt(origin.uid),
        gid: toBigInt(origin.gid),
        rdev: toBigInt(origin.rdev),
        size: toBigInt(origin.size) || 0n,
        blksize: toBigInt(origin.blksize),
        blocks: toBigInt(origin.blocks),
        mtime: origin.mtime,
        atime: origin.atime,
        birthtime: origin.birthtime,
        mtimeMs: origin.mtime ? BigInt(origin.mtime.getTime()) : null,
        atimeMs: origin.atime ? BigInt(origin.atime.getTime()) : null,
        birthtimeMs: origin.birthtime ? BigInt(origin.birthtime.getTime()) : null,
        mtimeNs: origin.mtime ? BigInt(origin.mtime.getTime()) * 1000000n : null,
        atimeNs: origin.atime ? BigInt(origin.atime.getTime()) * 1000000n : null,
        birthtimeNs: origin.birthtime ? BigInt(origin.birthtime.getTime()) * 1000000n : null,
        isFile: ()=>origin.isFile,
        isDirectory: ()=>origin.isDirectory,
        isSymbolicLink: ()=>origin.isSymlink,
        // not sure about those
        isBlockDevice: ()=>false,
        isFIFO: ()=>false,
        isCharacterDevice: ()=>false,
        isSocket: ()=>false,
        ctime: origin.mtime,
        ctimeMs: origin.mtime ? BigInt(origin.mtime.getTime()) : null,
        ctimeNs: origin.mtime ? BigInt(origin.mtime.getTime()) * 1000000n : null
    };
}
// shortcut for Convert File Info to Stats or BigIntStats
export function CFISBIS(fileInfo, bigInt) {
    if (bigInt) return convertFileInfoToBigIntStats(fileInfo);
    return convertFileInfoToStats(fileInfo);
}
export function stat(path, optionsOrCallback, maybeCallback) {
    const callback = typeof optionsOrCallback === "function" ? optionsOrCallback : maybeCallback;
    const options = typeof optionsOrCallback === "object" ? optionsOrCallback : {
        bigint: false
    };
    if (!callback) throw new Error("No callback function supplied");
    Deno.stat(path).then((stat)=>callback(null, CFISBIS(stat, options.bigint)), (err)=>callback(denoErrorToNodeError(err, {
            syscall: "stat"
        })));
}
export const statPromise = promisify(stat);
export function statSync(path, options = {
    bigint: false,
    throwIfNoEntry: true
}) {
    try {
        const origin = Deno.statSync(path);
        return CFISBIS(origin, options.bigint);
    } catch (err) {
        if (options?.throwIfNoEntry === false && err instanceof Deno.errors.NotFound) {
            return;
        }
        if (err instanceof Error) {
            throw denoErrorToNodeError(err, {
                syscall: "stat"
            });
        } else {
            throw err;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3N0ZEAwLjE2Ny4wL25vZGUvX2ZzL19mc19zdGF0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE4LTIwMjIgdGhlIERlbm8gYXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4gTUlUIGxpY2Vuc2UuXG5pbXBvcnQgeyBkZW5vRXJyb3JUb05vZGVFcnJvciB9IGZyb20gXCIuLi9pbnRlcm5hbC9lcnJvcnMudHNcIjtcbmltcG9ydCB7IHByb21pc2lmeSB9IGZyb20gXCIuLi9pbnRlcm5hbC91dGlsLm1qc1wiO1xuXG5leHBvcnQgdHlwZSBzdGF0T3B0aW9ucyA9IHtcbiAgYmlnaW50OiBib29sZWFuO1xuICB0aHJvd0lmTm9FbnRyeT86IGJvb2xlYW47XG59O1xuXG5leHBvcnQgdHlwZSBTdGF0cyA9IHtcbiAgLyoqIElEIG9mIHRoZSBkZXZpY2UgY29udGFpbmluZyB0aGUgZmlsZS5cbiAgICpcbiAgICogX0xpbnV4L01hYyBPUyBvbmx5Ll8gKi9cbiAgZGV2OiBudW1iZXIgfCBudWxsO1xuICAvKiogSW5vZGUgbnVtYmVyLlxuICAgKlxuICAgKiBfTGludXgvTWFjIE9TIG9ubHkuXyAqL1xuICBpbm86IG51bWJlciB8IG51bGw7XG4gIC8qKiAqKlVOU1RBQkxFKio6IE1hdGNoIGJlaGF2aW9yIHdpdGggR28gb24gV2luZG93cyBmb3IgYG1vZGVgLlxuICAgKlxuICAgKiBUaGUgdW5kZXJseWluZyByYXcgYHN0X21vZGVgIGJpdHMgdGhhdCBjb250YWluIHRoZSBzdGFuZGFyZCBVbml4XG4gICAqIHBlcm1pc3Npb25zIGZvciB0aGlzIGZpbGUvZGlyZWN0b3J5LiAqL1xuICBtb2RlOiBudW1iZXIgfCBudWxsO1xuICAvKiogTnVtYmVyIG9mIGhhcmQgbGlua3MgcG9pbnRpbmcgdG8gdGhpcyBmaWxlLlxuICAgKlxuICAgKiBfTGludXgvTWFjIE9TIG9ubHkuXyAqL1xuICBubGluazogbnVtYmVyIHwgbnVsbDtcbiAgLyoqIFVzZXIgSUQgb2YgdGhlIG93bmVyIG9mIHRoaXMgZmlsZS5cbiAgICpcbiAgICogX0xpbnV4L01hYyBPUyBvbmx5Ll8gKi9cbiAgdWlkOiBudW1iZXIgfCBudWxsO1xuICAvKiogR3JvdXAgSUQgb2YgdGhlIG93bmVyIG9mIHRoaXMgZmlsZS5cbiAgICpcbiAgICogX0xpbnV4L01hYyBPUyBvbmx5Ll8gKi9cbiAgZ2lkOiBudW1iZXIgfCBudWxsO1xuICAvKiogRGV2aWNlIElEIG9mIHRoaXMgZmlsZS5cbiAgICpcbiAgICogX0xpbnV4L01hYyBPUyBvbmx5Ll8gKi9cbiAgcmRldjogbnVtYmVyIHwgbnVsbDtcbiAgLyoqIFRoZSBzaXplIG9mIHRoZSBmaWxlLCBpbiBieXRlcy4gKi9cbiAgc2l6ZTogbnVtYmVyO1xuICAvKiogQmxvY2tzaXplIGZvciBmaWxlc3lzdGVtIEkvTy5cbiAgICpcbiAgICogX0xpbnV4L01hYyBPUyBvbmx5Ll8gKi9cbiAgYmxrc2l6ZTogbnVtYmVyIHwgbnVsbDtcbiAgLyoqIE51bWJlciBvZiBibG9ja3MgYWxsb2NhdGVkIHRvIHRoZSBmaWxlLCBpbiA1MTItYnl0ZSB1bml0cy5cbiAgICpcbiAgICogX0xpbnV4L01hYyBPUyBvbmx5Ll8gKi9cbiAgYmxvY2tzOiBudW1iZXIgfCBudWxsO1xuICAvKiogVGhlIGxhc3QgbW9kaWZpY2F0aW9uIHRpbWUgb2YgdGhlIGZpbGUuIFRoaXMgY29ycmVzcG9uZHMgdG8gdGhlIGBtdGltZWBcbiAgICogZmllbGQgZnJvbSBgc3RhdGAgb24gTGludXgvTWFjIE9TIGFuZCBgZnRMYXN0V3JpdGVUaW1lYCBvbiBXaW5kb3dzLiBUaGlzXG4gICAqIG1heSBub3QgYmUgYXZhaWxhYmxlIG9uIGFsbCBwbGF0Zm9ybXMuICovXG4gIG10aW1lOiBEYXRlIHwgbnVsbDtcbiAgLyoqIFRoZSBsYXN0IGFjY2VzcyB0aW1lIG9mIHRoZSBmaWxlLiBUaGlzIGNvcnJlc3BvbmRzIHRvIHRoZSBgYXRpbWVgXG4gICAqIGZpZWxkIGZyb20gYHN0YXRgIG9uIFVuaXggYW5kIGBmdExhc3RBY2Nlc3NUaW1lYCBvbiBXaW5kb3dzLiBUaGlzIG1heSBub3RcbiAgICogYmUgYXZhaWxhYmxlIG9uIGFsbCBwbGF0Zm9ybXMuICovXG4gIGF0aW1lOiBEYXRlIHwgbnVsbDtcbiAgLyoqIFRoZSBjcmVhdGlvbiB0aW1lIG9mIHRoZSBmaWxlLiBUaGlzIGNvcnJlc3BvbmRzIHRvIHRoZSBgYmlydGh0aW1lYFxuICAgKiBmaWVsZCBmcm9tIGBzdGF0YCBvbiBNYWMvQlNEIGFuZCBgZnRDcmVhdGlvblRpbWVgIG9uIFdpbmRvd3MuIFRoaXMgbWF5XG4gICAqIG5vdCBiZSBhdmFpbGFibGUgb24gYWxsIHBsYXRmb3Jtcy4gKi9cbiAgYmlydGh0aW1lOiBEYXRlIHwgbnVsbDtcbiAgLyoqIGNoYW5nZSB0aW1lICovXG4gIGN0aW1lOiBEYXRlIHwgbnVsbDtcbiAgLyoqIGF0aW1lIGluIG1pbGxpc2Vjb25kcyAqL1xuICBhdGltZU1zOiBudW1iZXIgfCBudWxsO1xuICAvKiogYXRpbWUgaW4gbWlsbGlzZWNvbmRzICovXG4gIG10aW1lTXM6IG51bWJlciB8IG51bGw7XG4gIC8qKiBhdGltZSBpbiBtaWxsaXNlY29uZHMgKi9cbiAgY3RpbWVNczogbnVtYmVyIHwgbnVsbDtcbiAgLyoqIGF0aW1lIGluIG1pbGxpc2Vjb25kcyAqL1xuICBiaXJ0aHRpbWVNczogbnVtYmVyIHwgbnVsbDtcbiAgaXNCbG9ja0RldmljZTogKCkgPT4gYm9vbGVhbjtcbiAgaXNDaGFyYWN0ZXJEZXZpY2U6ICgpID0+IGJvb2xlYW47XG4gIGlzRGlyZWN0b3J5OiAoKSA9PiBib29sZWFuO1xuICBpc0ZJRk86ICgpID0+IGJvb2xlYW47XG4gIGlzRmlsZTogKCkgPT4gYm9vbGVhbjtcbiAgaXNTb2NrZXQ6ICgpID0+IGJvb2xlYW47XG4gIGlzU3ltYm9saWNMaW5rOiAoKSA9PiBib29sZWFuO1xufTtcblxuZXhwb3J0IHR5cGUgQmlnSW50U3RhdHMgPSB7XG4gIC8qKiBJRCBvZiB0aGUgZGV2aWNlIGNvbnRhaW5pbmcgdGhlIGZpbGUuXG4gICAqXG4gICAqIF9MaW51eC9NYWMgT1Mgb25seS5fICovXG4gIGRldjogQmlnSW50IHwgbnVsbDtcbiAgLyoqIElub2RlIG51bWJlci5cbiAgICpcbiAgICogX0xpbnV4L01hYyBPUyBvbmx5Ll8gKi9cbiAgaW5vOiBCaWdJbnQgfCBudWxsO1xuICAvKiogKipVTlNUQUJMRSoqOiBNYXRjaCBiZWhhdmlvciB3aXRoIEdvIG9uIFdpbmRvd3MgZm9yIGBtb2RlYC5cbiAgICpcbiAgICogVGhlIHVuZGVybHlpbmcgcmF3IGBzdF9tb2RlYCBiaXRzIHRoYXQgY29udGFpbiB0aGUgc3RhbmRhcmQgVW5peFxuICAgKiBwZXJtaXNzaW9ucyBmb3IgdGhpcyBmaWxlL2RpcmVjdG9yeS4gKi9cbiAgbW9kZTogQmlnSW50IHwgbnVsbDtcbiAgLyoqIE51bWJlciBvZiBoYXJkIGxpbmtzIHBvaW50aW5nIHRvIHRoaXMgZmlsZS5cbiAgICpcbiAgICogX0xpbnV4L01hYyBPUyBvbmx5Ll8gKi9cbiAgbmxpbms6IEJpZ0ludCB8IG51bGw7XG4gIC8qKiBVc2VyIElEIG9mIHRoZSBvd25lciBvZiB0aGlzIGZpbGUuXG4gICAqXG4gICAqIF9MaW51eC9NYWMgT1Mgb25seS5fICovXG4gIHVpZDogQmlnSW50IHwgbnVsbDtcbiAgLyoqIEdyb3VwIElEIG9mIHRoZSBvd25lciBvZiB0aGlzIGZpbGUuXG4gICAqXG4gICAqIF9MaW51eC9NYWMgT1Mgb25seS5fICovXG4gIGdpZDogQmlnSW50IHwgbnVsbDtcbiAgLyoqIERldmljZSBJRCBvZiB0aGlzIGZpbGUuXG4gICAqXG4gICAqIF9MaW51eC9NYWMgT1Mgb25seS5fICovXG4gIHJkZXY6IEJpZ0ludCB8IG51bGw7XG4gIC8qKiBUaGUgc2l6ZSBvZiB0aGUgZmlsZSwgaW4gYnl0ZXMuICovXG4gIHNpemU6IEJpZ0ludDtcbiAgLyoqIEJsb2Nrc2l6ZSBmb3IgZmlsZXN5c3RlbSBJL08uXG4gICAqXG4gICAqIF9MaW51eC9NYWMgT1Mgb25seS5fICovXG4gIGJsa3NpemU6IEJpZ0ludCB8IG51bGw7XG4gIC8qKiBOdW1iZXIgb2YgYmxvY2tzIGFsbG9jYXRlZCB0byB0aGUgZmlsZSwgaW4gNTEyLWJ5dGUgdW5pdHMuXG4gICAqXG4gICAqIF9MaW51eC9NYWMgT1Mgb25seS5fICovXG4gIGJsb2NrczogQmlnSW50IHwgbnVsbDtcbiAgLyoqIFRoZSBsYXN0IG1vZGlmaWNhdGlvbiB0aW1lIG9mIHRoZSBmaWxlLiBUaGlzIGNvcnJlc3BvbmRzIHRvIHRoZSBgbXRpbWVgXG4gICAqIGZpZWxkIGZyb20gYHN0YXRgIG9uIExpbnV4L01hYyBPUyBhbmQgYGZ0TGFzdFdyaXRlVGltZWAgb24gV2luZG93cy4gVGhpc1xuICAgKiBtYXkgbm90IGJlIGF2YWlsYWJsZSBvbiBhbGwgcGxhdGZvcm1zLiAqL1xuICBtdGltZTogRGF0ZSB8IG51bGw7XG4gIC8qKiBUaGUgbGFzdCBhY2Nlc3MgdGltZSBvZiB0aGUgZmlsZS4gVGhpcyBjb3JyZXNwb25kcyB0byB0aGUgYGF0aW1lYFxuICAgKiBmaWVsZCBmcm9tIGBzdGF0YCBvbiBVbml4IGFuZCBgZnRMYXN0QWNjZXNzVGltZWAgb24gV2luZG93cy4gVGhpcyBtYXkgbm90XG4gICAqIGJlIGF2YWlsYWJsZSBvbiBhbGwgcGxhdGZvcm1zLiAqL1xuICBhdGltZTogRGF0ZSB8IG51bGw7XG4gIC8qKiBUaGUgY3JlYXRpb24gdGltZSBvZiB0aGUgZmlsZS4gVGhpcyBjb3JyZXNwb25kcyB0byB0aGUgYGJpcnRodGltZWBcbiAgICogZmllbGQgZnJvbSBgc3RhdGAgb24gTWFjL0JTRCBhbmQgYGZ0Q3JlYXRpb25UaW1lYCBvbiBXaW5kb3dzLiBUaGlzIG1heVxuICAgKiBub3QgYmUgYXZhaWxhYmxlIG9uIGFsbCBwbGF0Zm9ybXMuICovXG4gIGJpcnRodGltZTogRGF0ZSB8IG51bGw7XG4gIC8qKiBjaGFuZ2UgdGltZSAqL1xuICBjdGltZTogRGF0ZSB8IG51bGw7XG4gIC8qKiBhdGltZSBpbiBtaWxsaXNlY29uZHMgKi9cbiAgYXRpbWVNczogQmlnSW50IHwgbnVsbDtcbiAgLyoqIGF0aW1lIGluIG1pbGxpc2Vjb25kcyAqL1xuICBtdGltZU1zOiBCaWdJbnQgfCBudWxsO1xuICAvKiogYXRpbWUgaW4gbWlsbGlzZWNvbmRzICovXG4gIGN0aW1lTXM6IEJpZ0ludCB8IG51bGw7XG4gIC8qKiBhdGltZSBpbiBuYW5vc2Vjb25kcyAqL1xuICBiaXJ0aHRpbWVNczogQmlnSW50IHwgbnVsbDtcbiAgLyoqIGF0aW1lIGluIG5hbm9zZWNvbmRzICovXG4gIGF0aW1lTnM6IEJpZ0ludCB8IG51bGw7XG4gIC8qKiBhdGltZSBpbiBuYW5vc2Vjb25kcyAqL1xuICBtdGltZU5zOiBCaWdJbnQgfCBudWxsO1xuICAvKiogYXRpbWUgaW4gbmFub3NlY29uZHMgKi9cbiAgY3RpbWVOczogQmlnSW50IHwgbnVsbDtcbiAgLyoqIGF0aW1lIGluIG5hbm9zZWNvbmRzICovXG4gIGJpcnRodGltZU5zOiBCaWdJbnQgfCBudWxsO1xuICBpc0Jsb2NrRGV2aWNlOiAoKSA9PiBib29sZWFuO1xuICBpc0NoYXJhY3RlckRldmljZTogKCkgPT4gYm9vbGVhbjtcbiAgaXNEaXJlY3Rvcnk6ICgpID0+IGJvb2xlYW47XG4gIGlzRklGTzogKCkgPT4gYm9vbGVhbjtcbiAgaXNGaWxlOiAoKSA9PiBib29sZWFuO1xuICBpc1NvY2tldDogKCkgPT4gYm9vbGVhbjtcbiAgaXNTeW1ib2xpY0xpbms6ICgpID0+IGJvb2xlYW47XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gY29udmVydEZpbGVJbmZvVG9TdGF0cyhvcmlnaW46IERlbm8uRmlsZUluZm8pOiBTdGF0cyB7XG4gIHJldHVybiB7XG4gICAgZGV2OiBvcmlnaW4uZGV2LFxuICAgIGlubzogb3JpZ2luLmlubyxcbiAgICBtb2RlOiBvcmlnaW4ubW9kZSxcbiAgICBubGluazogb3JpZ2luLm5saW5rLFxuICAgIHVpZDogb3JpZ2luLnVpZCxcbiAgICBnaWQ6IG9yaWdpbi5naWQsXG4gICAgcmRldjogb3JpZ2luLnJkZXYsXG4gICAgc2l6ZTogb3JpZ2luLnNpemUsXG4gICAgYmxrc2l6ZTogb3JpZ2luLmJsa3NpemUsXG4gICAgYmxvY2tzOiBvcmlnaW4uYmxvY2tzLFxuICAgIG10aW1lOiBvcmlnaW4ubXRpbWUsXG4gICAgYXRpbWU6IG9yaWdpbi5hdGltZSxcbiAgICBiaXJ0aHRpbWU6IG9yaWdpbi5iaXJ0aHRpbWUsXG4gICAgbXRpbWVNczogb3JpZ2luLm10aW1lPy5nZXRUaW1lKCkgfHwgbnVsbCxcbiAgICBhdGltZU1zOiBvcmlnaW4uYXRpbWU/LmdldFRpbWUoKSB8fCBudWxsLFxuICAgIGJpcnRodGltZU1zOiBvcmlnaW4uYmlydGh0aW1lPy5nZXRUaW1lKCkgfHwgbnVsbCxcbiAgICBpc0ZpbGU6ICgpID0+IG9yaWdpbi5pc0ZpbGUsXG4gICAgaXNEaXJlY3Rvcnk6ICgpID0+IG9yaWdpbi5pc0RpcmVjdG9yeSxcbiAgICBpc1N5bWJvbGljTGluazogKCkgPT4gb3JpZ2luLmlzU3ltbGluayxcbiAgICAvLyBub3Qgc3VyZSBhYm91dCB0aG9zZVxuICAgIGlzQmxvY2tEZXZpY2U6ICgpID0+IGZhbHNlLFxuICAgIGlzRklGTzogKCkgPT4gZmFsc2UsXG4gICAgaXNDaGFyYWN0ZXJEZXZpY2U6ICgpID0+IGZhbHNlLFxuICAgIGlzU29ja2V0OiAoKSA9PiBmYWxzZSxcbiAgICBjdGltZTogb3JpZ2luLm10aW1lLFxuICAgIGN0aW1lTXM6IG9yaWdpbi5tdGltZT8uZ2V0VGltZSgpIHx8IG51bGwsXG4gIH07XG59XG5cbmZ1bmN0aW9uIHRvQmlnSW50KG51bWJlcj86IG51bWJlciB8IG51bGwpIHtcbiAgaWYgKG51bWJlciA9PT0gbnVsbCB8fCBudW1iZXIgPT09IHVuZGVmaW5lZCkgcmV0dXJuIG51bGw7XG4gIHJldHVybiBCaWdJbnQobnVtYmVyKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbnZlcnRGaWxlSW5mb1RvQmlnSW50U3RhdHMoXG4gIG9yaWdpbjogRGVuby5GaWxlSW5mbyxcbik6IEJpZ0ludFN0YXRzIHtcbiAgcmV0dXJuIHtcbiAgICBkZXY6IHRvQmlnSW50KG9yaWdpbi5kZXYpLFxuICAgIGlubzogdG9CaWdJbnQob3JpZ2luLmlubyksXG4gICAgbW9kZTogdG9CaWdJbnQob3JpZ2luLm1vZGUpLFxuICAgIG5saW5rOiB0b0JpZ0ludChvcmlnaW4ubmxpbmspLFxuICAgIHVpZDogdG9CaWdJbnQob3JpZ2luLnVpZCksXG4gICAgZ2lkOiB0b0JpZ0ludChvcmlnaW4uZ2lkKSxcbiAgICByZGV2OiB0b0JpZ0ludChvcmlnaW4ucmRldiksXG4gICAgc2l6ZTogdG9CaWdJbnQob3JpZ2luLnNpemUpIHx8IDBuLFxuICAgIGJsa3NpemU6IHRvQmlnSW50KG9yaWdpbi5ibGtzaXplKSxcbiAgICBibG9ja3M6IHRvQmlnSW50KG9yaWdpbi5ibG9ja3MpLFxuICAgIG10aW1lOiBvcmlnaW4ubXRpbWUsXG4gICAgYXRpbWU6IG9yaWdpbi5hdGltZSxcbiAgICBiaXJ0aHRpbWU6IG9yaWdpbi5iaXJ0aHRpbWUsXG4gICAgbXRpbWVNczogb3JpZ2luLm10aW1lID8gQmlnSW50KG9yaWdpbi5tdGltZS5nZXRUaW1lKCkpIDogbnVsbCxcbiAgICBhdGltZU1zOiBvcmlnaW4uYXRpbWUgPyBCaWdJbnQob3JpZ2luLmF0aW1lLmdldFRpbWUoKSkgOiBudWxsLFxuICAgIGJpcnRodGltZU1zOiBvcmlnaW4uYmlydGh0aW1lID8gQmlnSW50KG9yaWdpbi5iaXJ0aHRpbWUuZ2V0VGltZSgpKSA6IG51bGwsXG4gICAgbXRpbWVOczogb3JpZ2luLm10aW1lID8gQmlnSW50KG9yaWdpbi5tdGltZS5nZXRUaW1lKCkpICogMTAwMDAwMG4gOiBudWxsLFxuICAgIGF0aW1lTnM6IG9yaWdpbi5hdGltZSA/IEJpZ0ludChvcmlnaW4uYXRpbWUuZ2V0VGltZSgpKSAqIDEwMDAwMDBuIDogbnVsbCxcbiAgICBiaXJ0aHRpbWVOczogb3JpZ2luLmJpcnRodGltZVxuICAgICAgPyBCaWdJbnQob3JpZ2luLmJpcnRodGltZS5nZXRUaW1lKCkpICogMTAwMDAwMG5cbiAgICAgIDogbnVsbCxcbiAgICBpc0ZpbGU6ICgpID0+IG9yaWdpbi5pc0ZpbGUsXG4gICAgaXNEaXJlY3Rvcnk6ICgpID0+IG9yaWdpbi5pc0RpcmVjdG9yeSxcbiAgICBpc1N5bWJvbGljTGluazogKCkgPT4gb3JpZ2luLmlzU3ltbGluayxcbiAgICAvLyBub3Qgc3VyZSBhYm91dCB0aG9zZVxuICAgIGlzQmxvY2tEZXZpY2U6ICgpID0+IGZhbHNlLFxuICAgIGlzRklGTzogKCkgPT4gZmFsc2UsXG4gICAgaXNDaGFyYWN0ZXJEZXZpY2U6ICgpID0+IGZhbHNlLFxuICAgIGlzU29ja2V0OiAoKSA9PiBmYWxzZSxcbiAgICBjdGltZTogb3JpZ2luLm10aW1lLFxuICAgIGN0aW1lTXM6IG9yaWdpbi5tdGltZSA/IEJpZ0ludChvcmlnaW4ubXRpbWUuZ2V0VGltZSgpKSA6IG51bGwsXG4gICAgY3RpbWVOczogb3JpZ2luLm10aW1lID8gQmlnSW50KG9yaWdpbi5tdGltZS5nZXRUaW1lKCkpICogMTAwMDAwMG4gOiBudWxsLFxuICB9O1xufVxuXG4vLyBzaG9ydGN1dCBmb3IgQ29udmVydCBGaWxlIEluZm8gdG8gU3RhdHMgb3IgQmlnSW50U3RhdHNcbmV4cG9ydCBmdW5jdGlvbiBDRklTQklTKGZpbGVJbmZvOiBEZW5vLkZpbGVJbmZvLCBiaWdJbnQ6IGJvb2xlYW4pIHtcbiAgaWYgKGJpZ0ludCkgcmV0dXJuIGNvbnZlcnRGaWxlSW5mb1RvQmlnSW50U3RhdHMoZmlsZUluZm8pO1xuICByZXR1cm4gY29udmVydEZpbGVJbmZvVG9TdGF0cyhmaWxlSW5mbyk7XG59XG5cbmV4cG9ydCB0eXBlIHN0YXRDYWxsYmFja0JpZ0ludCA9IChlcnI6IEVycm9yIHwgbnVsbCwgc3RhdDogQmlnSW50U3RhdHMpID0+IHZvaWQ7XG5cbmV4cG9ydCB0eXBlIHN0YXRDYWxsYmFjayA9IChlcnI6IEVycm9yIHwgbnVsbCwgc3RhdDogU3RhdHMpID0+IHZvaWQ7XG5cbmV4cG9ydCBmdW5jdGlvbiBzdGF0KHBhdGg6IHN0cmluZyB8IFVSTCwgY2FsbGJhY2s6IHN0YXRDYWxsYmFjayk6IHZvaWQ7XG5leHBvcnQgZnVuY3Rpb24gc3RhdChcbiAgcGF0aDogc3RyaW5nIHwgVVJMLFxuICBvcHRpb25zOiB7IGJpZ2ludDogZmFsc2UgfSxcbiAgY2FsbGJhY2s6IHN0YXRDYWxsYmFjayxcbik6IHZvaWQ7XG5leHBvcnQgZnVuY3Rpb24gc3RhdChcbiAgcGF0aDogc3RyaW5nIHwgVVJMLFxuICBvcHRpb25zOiB7IGJpZ2ludDogdHJ1ZSB9LFxuICBjYWxsYmFjazogc3RhdENhbGxiYWNrQmlnSW50LFxuKTogdm9pZDtcbmV4cG9ydCBmdW5jdGlvbiBzdGF0KFxuICBwYXRoOiBzdHJpbmcgfCBVUkwsXG4gIG9wdGlvbnNPckNhbGxiYWNrOiBzdGF0Q2FsbGJhY2sgfCBzdGF0Q2FsbGJhY2tCaWdJbnQgfCBzdGF0T3B0aW9ucyxcbiAgbWF5YmVDYWxsYmFjaz86IHN0YXRDYWxsYmFjayB8IHN0YXRDYWxsYmFja0JpZ0ludCxcbikge1xuICBjb25zdCBjYWxsYmFjayA9XG4gICAgKHR5cGVvZiBvcHRpb25zT3JDYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiXG4gICAgICA/IG9wdGlvbnNPckNhbGxiYWNrXG4gICAgICA6IG1heWJlQ2FsbGJhY2spIGFzIChcbiAgICAgICAgLi4uYXJnczogW0Vycm9yXSB8IFtudWxsLCBCaWdJbnRTdGF0cyB8IFN0YXRzXVxuICAgICAgKSA9PiB2b2lkO1xuICBjb25zdCBvcHRpb25zID0gdHlwZW9mIG9wdGlvbnNPckNhbGxiYWNrID09PSBcIm9iamVjdFwiXG4gICAgPyBvcHRpb25zT3JDYWxsYmFja1xuICAgIDogeyBiaWdpbnQ6IGZhbHNlIH07XG5cbiAgaWYgKCFjYWxsYmFjaykgdGhyb3cgbmV3IEVycm9yKFwiTm8gY2FsbGJhY2sgZnVuY3Rpb24gc3VwcGxpZWRcIik7XG5cbiAgRGVuby5zdGF0KHBhdGgpLnRoZW4oXG4gICAgKHN0YXQpID0+IGNhbGxiYWNrKG51bGwsIENGSVNCSVMoc3RhdCwgb3B0aW9ucy5iaWdpbnQpKSxcbiAgICAoZXJyKSA9PiBjYWxsYmFjayhkZW5vRXJyb3JUb05vZGVFcnJvcihlcnIsIHsgc3lzY2FsbDogXCJzdGF0XCIgfSkpLFxuICApO1xufVxuXG5leHBvcnQgY29uc3Qgc3RhdFByb21pc2UgPSBwcm9taXNpZnkoc3RhdCkgYXMgKFxuICAmICgocGF0aDogc3RyaW5nIHwgVVJMKSA9PiBQcm9taXNlPFN0YXRzPilcbiAgJiAoKHBhdGg6IHN0cmluZyB8IFVSTCwgb3B0aW9uczogeyBiaWdpbnQ6IGZhbHNlIH0pID0+IFByb21pc2U8U3RhdHM+KVxuICAmICgocGF0aDogc3RyaW5nIHwgVVJMLCBvcHRpb25zOiB7IGJpZ2ludDogdHJ1ZSB9KSA9PiBQcm9taXNlPEJpZ0ludFN0YXRzPilcbik7XG5cbmV4cG9ydCBmdW5jdGlvbiBzdGF0U3luYyhwYXRoOiBzdHJpbmcgfCBVUkwpOiBTdGF0cztcbmV4cG9ydCBmdW5jdGlvbiBzdGF0U3luYyhcbiAgcGF0aDogc3RyaW5nIHwgVVJMLFxuICBvcHRpb25zOiB7IGJpZ2ludDogZmFsc2U7IHRocm93SWZOb0VudHJ5PzogYm9vbGVhbiB9LFxuKTogU3RhdHM7XG5leHBvcnQgZnVuY3Rpb24gc3RhdFN5bmMoXG4gIHBhdGg6IHN0cmluZyB8IFVSTCxcbiAgb3B0aW9uczogeyBiaWdpbnQ6IHRydWU7IHRocm93SWZOb0VudHJ5PzogYm9vbGVhbiB9LFxuKTogQmlnSW50U3RhdHM7XG5leHBvcnQgZnVuY3Rpb24gc3RhdFN5bmMoXG4gIHBhdGg6IHN0cmluZyB8IFVSTCxcbiAgb3B0aW9uczogc3RhdE9wdGlvbnMgPSB7IGJpZ2ludDogZmFsc2UsIHRocm93SWZOb0VudHJ5OiB0cnVlIH0sXG4pOiBTdGF0cyB8IEJpZ0ludFN0YXRzIHwgdW5kZWZpbmVkIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBvcmlnaW4gPSBEZW5vLnN0YXRTeW5jKHBhdGgpO1xuICAgIHJldHVybiBDRklTQklTKG9yaWdpbiwgb3B0aW9ucy5iaWdpbnQpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBpZiAoXG4gICAgICBvcHRpb25zPy50aHJvd0lmTm9FbnRyeSA9PT0gZmFsc2UgJiZcbiAgICAgIGVyciBpbnN0YW5jZW9mIERlbm8uZXJyb3JzLk5vdEZvdW5kXG4gICAgKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChlcnIgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgdGhyb3cgZGVub0Vycm9yVG9Ob2RlRXJyb3IoZXJyLCB7IHN5c2NhbGw6IFwic3RhdFwiIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsMEVBQTBFO0FBQzFFLFNBQVMsb0JBQW9CLFFBQVEsd0JBQXdCO0FBQzdELFNBQVMsU0FBUyxRQUFRLHVCQUF1QjtBQTZKakQsT0FBTyxTQUFTLHVCQUF1QixNQUFxQixFQUFTO0lBQ25FLE9BQU87UUFDTCxLQUFLLE9BQU8sR0FBRztRQUNmLEtBQUssT0FBTyxHQUFHO1FBQ2YsTUFBTSxPQUFPLElBQUk7UUFDakIsT0FBTyxPQUFPLEtBQUs7UUFDbkIsS0FBSyxPQUFPLEdBQUc7UUFDZixLQUFLLE9BQU8sR0FBRztRQUNmLE1BQU0sT0FBTyxJQUFJO1FBQ2pCLE1BQU0sT0FBTyxJQUFJO1FBQ2pCLFNBQVMsT0FBTyxPQUFPO1FBQ3ZCLFFBQVEsT0FBTyxNQUFNO1FBQ3JCLE9BQU8sT0FBTyxLQUFLO1FBQ25CLE9BQU8sT0FBTyxLQUFLO1FBQ25CLFdBQVcsT0FBTyxTQUFTO1FBQzNCLFNBQVMsT0FBTyxLQUFLLEVBQUUsYUFBYSxJQUFJO1FBQ3hDLFNBQVMsT0FBTyxLQUFLLEVBQUUsYUFBYSxJQUFJO1FBQ3hDLGFBQWEsT0FBTyxTQUFTLEVBQUUsYUFBYSxJQUFJO1FBQ2hELFFBQVEsSUFBTSxPQUFPLE1BQU07UUFDM0Is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